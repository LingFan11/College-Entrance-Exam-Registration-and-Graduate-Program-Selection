# 前端子模块：学校信息组件（V1）

本组件实现“学校信息模块”的前端页面骨架与 API 对接，覆盖检索、列表、详情以及强势学科/特色专业/招生简章三个分栏展示。

- 组件路径：`frontend/src/components/SchoolInfo.vue`
- 接口封装：`frontend/src/api/school.ts`
- 集成入口：`frontend/src/App.vue` 新增“学校信息”分区

## 1. 页面流程（Mermaid）
```mermaid
flowchart TD
  A[进入学校信息分区] --> B[输入关键词/层级/省份]
  B --> C[点击检索]
  C --> D[GET /api/school/list]
  D --> E{是否有结果}
  E -- 否 --> B
  E -- 是 --> F[选择学校]
  F --> G[GET /api/school/{id}]
  G --> H[展示概况]
  H --> I[Tab: 强势学科]
  H --> J[Tab: 特色专业]
  H --> K[Tab: 招生简章]
  I --> I1[GET /api/school/{id}/disciplines/strength]
  J --> J1[GET /api/school/{id}/majors]
  K --> K1[GET /api/school/{id}/brochures]
```

## 2. 接口映射
- 检索列表：`GET /api/school/list?keyword=&level=&province=&page=&size=`
- 学校详情：`GET /api/school/{id}`
- 强势学科：`GET /api/school/{id}/disciplines/strength?year=&topN=&page=&size=&sortBy=&order=`
- 特色专业：`GET /api/school/{id}/majors?degree=&disciplineId=&page=&size=&sortBy=&order=`
- 招生简章：`GET /api/school/{id}/brochures?degree=&year=&page=&size=`
- 字典：`GET /api/school/dicts/levels`，`GET /api/school/dicts/disciplines?parentId=`
- 标签（预留）：`GET /api/school/tags?type=school&keyword=`（本页暂未使用）

统一返回容错：若后端返回原始数组/对象，前端包装为 `{status:'ok', data: ...}`。

## 3. 组件结构（伪代码）
- 方法与关键逻辑
```
setup() {
  states: keyword, level, province, levels, list, selectedId, detail, tab
  params: discParams{year, topN, sortBy, order, page, size}, majorParams{degree, ...}, broParams{degree, year, ...}

  bootstrap():
    levels <- listLevels()
    doSearch()

  doSearch():
    list <- listSchools({keyword, level, province, page:0, size:20})
    if (list not empty) selectSchool(list[0].id)

  selectSchool(id):
    detail <- getSchool(id)
    tab <- 'disc'
    parallel(loadDisciplines, loadMajors, loadBrochures)

  loadDisciplines():
    disciplines <- listStrengthDisciplines(selectedId, discParams)

  loadMajors():
    majors <- listMajors(selectedId, majorParams)

  loadBrochures():
    brochures <- listBrochures(selectedId, broParams)
}
```

## 4. 测试用例列表（手工/curl）
- 正常场景
  - 学校检索：`/api/school/list?keyword=东南&page=0&size=10`
  - 学校详情：`/api/school/1`
  - 强势学科：`/api/school/1/disciplines/strength?year=2024&topN=5`
  - 特色专业：`/api/school/1/majors?degree=本科`
  - 招生简章：`/api/school/1/brochures?degree=本科&year=2024`
- 边界场景
  - 只用筛选项（不填 keyword）；`size=1` 与 `size=100`
  - `topN` 省略默认 5；`year` 省略回退到最近年份
- 异常场景
  - id 不存在：应显示“暂无数据/友好提示”（后端返回 `status=unfit`）
  - 参数非法：全局异常提示

可复制 curl：
```bash
curl "http://localhost:8080/api/school/list?keyword=东南&page=0&size=10"
curl "http://localhost:8080/api/school/1"
curl "http://localhost:8080/api/school/1/disciplines/strength?year=2024&topN=5"
curl "http://localhost:8080/api/school/1/majors?degree=本科"
curl "http://localhost:8080/api/school/1/brochures?degree=本科&year=2024"
```

## 5. 运行与联调
- 前端：`cd frontend && npm install && npm run dev`
- 代理：确保 `/api` 指向后端 `http://localhost:8080`
- 首屏示例查询：默认关键词为“东南”，可直接检索；选中后切换 Tab 查看三类信息。

## 6. 异常与提示规范
- 当后端返回 `429` 时，组件当前实现仅做信息提示（留待后续联动按钮倒计时与禁用）。
- 未命中列表时，清空详情三栏并提示用户重新检索。

## 7. 后续计划
- 增加分页控件与加载状态骨架屏
- 详情页 Markdown 简介渲染与“展开/收起”
- 学科/专业树筛选与标签筛选（需要后端支持）

## 8. 分页与加载状态（2025-09-27）
本次更新已为列表与三类详情分栏补充分页与加载状态：

- 列表分页参数：`page`, `size`（UI: 每页 10/20/50，可切换）
- 学科分页参数：`page`, `size`（与 `topN`/`sortBy`/`order` 可并用）
- 专业分页参数：`page`, `size`
- 简章分页参数：`page`, `size`
- 各列表在请求期间展示“加载中...”，按钮禁用，避免重复提交
- 列表/分栏切换时重置页码到第 1 页

涉及文件：`frontend/src/components/SchoolInfo.vue`

### 8.1 手工测试用例
- 正常
  - 修改“检索结果”分页大小为 10/20/50，检查上一页/下一页状态与数据量
  - 切换学校后，三分栏页码均应重置为第 1 页
  - 学科分栏：修改 `每页` 与 `排序`，点击“刷新”后数据更新、分页正常
  - 专业/简章分栏：修改 `每页`，点击“刷新”后数据更新、分页正常
- 边界
  - 当返回条数 < size 时，“下一页”应禁用
  - 迅速重复点击“刷新”，期间按钮禁用，loading 文案显示
- 异常
  - 后端暂不可用时，顶部错误区显示错误信息，loading 状态能正确关闭

### 8.2 测试结果日志（节选）
- 2025-09-27 18:05：东南大学示例数据联调，列表 size=10/20/50 行为正确；
  - 学科分栏：year=2024, topN=5, size=10 时，返回 <=10 项，下一页禁用；
  - 专业分栏：degree=本科, size=20 时，返回示例 2 条，下一页禁用；
  - 简章分栏：degree=本科, year=2024, size=20 时，返回 1 条，下一页禁用；
- 快速重复点击刷新时，按钮处于禁用状态，无多发请求现象。

### 8.3 列表总条数/总页数
- 列表区域新增“总条数/总页数”展示，优先读取后端 Spring Page 字段：`data.totalElements`、`data.totalPages`；
- 翻页“是否有下一页”优先使用 `!data.last`，否则回退到 `(page+1) < totalPages` 或基于返回长度的启发式判断。
