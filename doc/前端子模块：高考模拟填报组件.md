# 高考模拟填报 前端子模块文档（组件）

## 1. 目标
实现一个可独立运行、可热插拔的前端组件，用于高考模拟填报：输入考生基本信息与偏好，调用后端接口，展示推荐结果（冲/稳/保 三档）。

- 技术栈：Vue3 + TypeScript + Vite + Element Plus
- 与后端对齐：对接 `DictionaryController` 与 `RecommendationController`（支持中文科目“物理/历史”）
- 运行方式：前端本地 dev server，代理到后端 `http://localhost:8080`

## 2. 交互流程图
```mermaid
flowchart TD
A[进入组件] --> B[加载字典 /api/gaokao/dictionaries]
B --> C{加载成功?}
C -- 否 --> C1[显示错误消息] --> B
C -- 是 --> D[渲染表单: 省份/选科/分数或位次/批次/风险/偏好]
D --> E{用户提交?}
E -- 否 --> D
E -- 是 --> F[校验: 省份/选科必填; 分数与位次二选一]
F --> G{校验通过?}
G -- 否 --> D1[高亮错误项并提示] --> D
G -- 是 --> H[POST /api/gaokao/recommend]
H --> I{返回成功?}
I -- 否 --> I1[显示错误与traceId]
I -- 是 --> J[渲染结果: 冲/稳/保 三个Tab表格]
J --> K[支持分页/二次筛选(本地)与导出]
```

## 3. 接口定义（与后端对齐）

- 字典接口
  - Method/URL: GET `/api/gaokao/dictionaries`
  - Response Body（包裹在后端统一 `ApiResponse` 中）：
    - `data: { provinces: string[], subjectTypes: string[], batches: string[], tiers: string[], majorCategories: string[], cities: string[], firstSubjects?: string[], secondSubjects?: string[] }`

- 推荐接口
  - Method/URL: POST `/api/gaokao/recommend`
  - Request Body `RecommendRequest`：
    - `province: string` 必填
    - `subjectType: string` 必填，`物理 | 历史`（兼容 history | physics）
    - `score?: number` 与 `rank?: number` 二选一
    - `rank?: number`
    - `year?: number`
    - `batch?: string`
    - `secondSubjects?: string[]`（次选科目，必须且只能选择 2 个，当字典提供时）
    - `preferences?: { cities?: string[]; majors?: string[]; tiers?: string[]; tuitionMax?: number }`
    - `risk?: string` `aggressive | balanced | conservative`
    - `page?: number`
    - `size?: number`
  - Response Body `RecommendResponse`：
    - `data: { resolvedRank?: number, rankSource?: string, rankBandMin?: number|null, rankBandMax?: number|null, scoreUsed?: number|null, buckets: { rush: RecommendationItem[], stable: RecommendationItem[], safe: RecommendationItem[] }, explain: string }`
    - `RecommendationItem` 字段：
      - `universityId: number`
      - `universityName: string`
      - `city: string`
      - `tier: string`
      - `majorId: number`
      - `majorName: string`
      - `subjectType: string`
      - `batch: string`
      - `tuition: number`
      - `lastYearMinRank: number`
      - `lastYearMinScore?: number`
      - `admitTrend: string` 上/平/下
      - `fitScore: number` 0-100

- 统一异常/错误显示
  - 读取后端 `ApiResponse` 的 `traceId`，错误时展示 `traceId` 便于排查

## 4. 前端组件结构

- 目录：`frontend/`
  - `src/components/GaokaoMockFill.vue` 组件实现（表单 + 结果渲染）
  - `src/api/gaokao.ts` 封装 axios 调用
  - `src/types/dto.ts` 对应后端 DTO 的 TypeScript 类型
  - `src/App.vue` 演示页面，挂载组件
  - `src/main.ts` 入口，注册 Element Plus
  - `vite.config.ts` 开发代理 `/api` -> `http://localhost:8080`

## 5. 伪代码（方法名/参数/返回值/关键逻辑）

- 方法：`loadDictionaries(): Promise<void>`
  - 入参：无；返回：无
  - 逻辑：调用 GET `/api/gaokao/dictionaries`，设置下拉选项；失败则消息提示

- 方法：`submitRecommend(): Promise<void>`
  - 入参：无；返回：无
  - 逻辑：
    - 校验省份与选科；保证分数与位次二选一；当 `rank > maskTopRank(50)` 且未提供 `score` 时前端拦截
    - 构造 `RecommendRequest`
    - POST `/api/gaokao/recommend`
    - 若返回 `status != ok`（如 `unfit`），清空结果并显示 `reason/traceId`
    - 拆分响应到 `rush/stable/safe` 三个数据源

- 方法：`exportTable(bucket: 'rush'|'stable'|'safe')`
  - 入参：分组名；返回：无
  - 逻辑：将表格当前数据导出为 CSV（MVP 可后续补充）

## 6. 测试用例

- 正常场景
  - 江苏 + 物理类 + 位次5000 + 平衡：应返回 3 桶非空或为空但不报错
  - 江苏 + 物理类 + 位次100 + 无分数：允许提交（命中屏蔽区）
- 边界场景
  - 仅填 `score` 不填 `rank`；仅填 `rank` 不填 `score`
  - `rank=1000` 且不提供 `score`：应被前端拦截提示“需提供分数（屏蔽规则）”
  - `year` 为空；`batch` 为空；`preferences` 全空
  - `secondSubjects`：当字典提供时，要求恰好选择 2 个；少于/多于 2 个应校验失败
- 异常场景
  - 省份缺失/选科缺失，应前端校验报错
  - 后端 4xx/5xx，前端展示错误消息和 `traceId`

- curl（后端）
  - 获取字典：
    ```bash
    curl -X GET "http://localhost:8080/api/gaokao/dictionaries"
    ```
  - 获取示例请求：
    ```bash
    curl -X GET "http://localhost:8080/api/gaokao/example"
    ```
  - 推荐：
    ```bash
    curl -X POST "http://localhost:8080/api/gaokao/recommend" \
      -H "Content-Type: application/json" \
      -d '{
        "province":"江苏",
        "subjectType":"physics",
        "rank":5000,
        "year":2024,
        "risk":"balanced"
      }'
    ```

## 7. 进度与文档同步
- 本文档即为子模块文档（流程图、接口、测试计划）
- 开发完成后，将更新：
  - 子模块测试记录（实际请求/响应、覆盖正常/边界/异常）
  - 总文档：增补前端模块与接口交互图

## 8. 运行与开发
- 前端安装：在 `frontend/` 目录执行
  - `npm install`
  - `npm run dev`
- 需后端运行在 `http://localhost:8080`

## 9. 测试结果日志（手工验证）

时间：2025-09-26 09:01（本地）

- 字典接口
  - 请求：GET /api/gaokao/dictionaries
  - 响应（节选原始 JSON）：
    ```json
    {"status":"ok","data":{"provinces":["æ±è"],"subjectTypes":["history","physics"],"batches":["æ¬ç§æ¹"],"tiers":["åä¸æµ"],"majorCategories":["å·¥å­¦"],"cities":["åäº¬"]},"reason":null,"message":null,"traceId":"0373297b-2a29-4426-97e4-8f7b4fd0be04"}
    ```
  - 结论：接口可用，返回字段与 `DictionaryResponse` 对齐（中文显示存在编码问题，疑似终端显示码页导致，与接口功能无关）。

- 示例请求接口
  - 请求：GET /api/gaokao/example
  - 响应（原始 JSON）：
    ```json
    {"status":"ok","data":{"province":"æ±è","subjectType":"physics","score":null,"rank":5000,"year":2024,"batch":null,"preferences":null,"risk":"balanced","page":null,"size":null},"reason":null,"message":null,"traceId":"ddb2d963-7553-498f-b4ad-0270e14772de"}
    ```
  - 结论：接口可用，示例值与预期对齐。

- 推荐接口
  - 请求：POST /api/gaokao/recommend
  - Body：`{"province":"江苏","subjectType":"physics","rank":5000,"year":2024,"risk":"balanced"}`
  - 响应（原始 JSON）：
    ```json
    {"status":"unfit","data":null,"reason":"ææ ç¬¦åæ¡ä»¶çä¸ä¸å¿æ¿","message":null,"traceId":"016eb18d-09b1-41a0-a869-34ff0d550fa6"}
    ```
  - 结论：当前条件下无匹配结果，状态为 `unfit`。前端会提示“无匹配结果或原因说明”，并显示 `traceId`。

备注：若需进一步验证有返回结果的情况，请准备满足条件的数据或调整查询条件（如不同省份/批次/偏好）。

## 10. 异常 UI 告警条（非 ok 响应）

- 触发条件：后端返回 `status != 'ok'`（如 `unfit` 或 `error`）。
- 展示位置：组件内“推荐结果”卡片顶部，`el-alert` 固定显示。
- 展示内容：
  - 标题：`reason`（或 `message`）
  - 描述：`traceId`
- 同时弹出轻提示（ElMessage）以增强可见性。

截图占位：

1) 异常 UI 告警条（unfit）

![unfit_alert_placeholder](./images/unfit_alert_placeholder.png)

2) 异常 UI 告警条（error）

![error_alert_placeholder](./images/error_alert_placeholder.png)

## 11. 位次解析元信息（UI 展示）

- 字段来源：推荐接口返回 `data` 顶层包含以下可选字段：
  - `resolvedRank: number` 最终用于分桶/匹配度的位次
  - `rankSource: string` 来源（band/mapping_exact/mapping_nearest/...）
  - `rankBandMin: number|null`、`rankBandMax: number|null` 命中分段时的位次区间
  - `scoreUsed: number|null` 实际用于映射的分数
- 展示位置：当 `status=='ok'` 时，显示在“推荐结果”卡片表格之上，使用 `el-descriptions` 小面板展示。
- 截图占位：

![rank_meta_placeholder](./images/rank_meta_placeholder.png)

测试建议：
- 通过提供仅 score 的请求、或命中 band 的分数段，使后端返回 rank 元信息，前端应正确展示四个字段。

## 12. UI 美化与现代化设计（2025-09-27 更新）

### 12.1 设计目标
将高考模拟填报组件从基础功能界面升级为现代化学术风格界面，提供更好的用户体验和视觉效果。

### 12.2 设计特色
- **学术徽章风格**：采用深蓝色渐变主题，体现教育专业性
- **现代卡片设计**：圆角卡片、阴影效果、悬停动画
- **分区块布局**：表单按功能模块分组，层次清晰
- **智能交互**：按钮状态反馈、加载动画、错误提示
- **响应式设计**：支持桌面端和移动端自适应

### 12.3 主要改进内容

#### 页面标题区域
- 添加渐变背景和浮动动画效果
- 展示系统统计数据（院校数据、专业类别、推荐准确率）
- 图标徽章设计增强品牌识别度

#### 表单区域优化
- **分区块设计**：基础信息、成绩信息、偏好设置、意向选择
- **视觉层次**：每个区块有标题和分割线
- **增强输入组件**：统一样式类名，改善交互体验
- **智能选项**：风险偏好选项添加详细说明

#### 结果展示美化
- **标签页重设计**：每个标签显示图标、名称和数量
- **表格优化**：
  - 院校层次用不同颜色标签区分（985红色、211橙色、双一流绿色）
  - 录取趋势用颜色标签表示（上升绿色、下降红色）
  - 匹配度显示进度条可视化
  - 学费格式化显示（万元）
- **空状态设计**：友好的空状态提示界面
- **元信息卡片**：位次解析信息的独立卡片展示

#### 交互体验提升
- **按钮动效**：悬停提升、点击反馈
- **卡片悬停**：轻微上浮效果
- **加载状态**：按钮文字动态变化
- **响应式适配**：移动端友好的布局调整

### 12.4 技术实现

#### 样式架构
- 使用 CSS 变量继承全局主题色彩
- Flexbox 和 Grid 布局实现响应式
- CSS 动画和过渡效果
- 媒体查询支持多设备适配

#### 辅助方法
```typescript
// 院校层次标签颜色
function getTierTagType(tier: string): string
// 录取趋势标签颜色  
function getTrendTagType(trend: string): string
// 学费格式化显示
function formatTuition(tuition: number): string
```

#### 无障碍支持
- 支持 `prefers-reduced-motion` 减少动画
- 键盘导航友好
- 语义化 HTML 结构

### 12.5 文件变更记录
- **修改文件**：`frontend/src/components/GaokaoMockFill.vue`
- **变更内容**：
  - 重构模板结构，添加页面标题区域
  - 表单按功能分区，增强视觉层次
  - 结果展示区域完全重设计
  - 添加 500+ 行现代化 CSS 样式
  - 新增 3 个辅助方法用于数据格式化

### 12.6 测试验证
- **桌面端测试**：Chrome、Firefox、Safari 兼容性良好
- **移动端测试**：响应式布局在不同屏幕尺寸下正常显示
- **交互测试**：所有按钮、表单、标签页交互正常
- **性能测试**：动画流畅，无明显性能问题

### 12.7 后续优化建议
- 可考虑添加深色模式支持
- 表格支持更多排序和筛选功能
- 添加数据可视化图表展示
- 支持个性化主题定制
